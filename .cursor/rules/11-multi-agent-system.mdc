---
description:
globs:
alwaysApply: false
---
# Multi-Agent System Architecture

CarbonSense implements a sophisticated multi-agent system powered by CrewAI to handle complex carbon footprint queries through specialized agent roles and coordinated workflows.

## Agent Roles

The system uses several specialized agents:

- **Parser Agent**: Extracts and normalizes product/quantity information from user queries
- **Research Agent**: Collects data from Milvus vector database and web sources using Watson Discovery
- **Harmonization Agent**: Standardizes metrics across sources and resolves conflicting information
- **Writer Agent**: Creates final user-friendly responses with proper formatting and citations

## Workflow Orchestration

The multi-agent workflow is defined in YAML configuration files:

- Agent definitions: [src/carbonsense/config/agents.yaml](mdc:src/carbonsense/config/agents.yaml)
- Task workflows: [src/carbonsense/config/tasks.yaml](mdc:src/carbonsense/config/tasks.yaml)
- System prompts: [src/carbonsense/config/prompts.yaml](mdc:src/carbonsense/config/prompts.yaml)

## Query Processing

User queries follow a five-layer processing pipeline:

1. **Query Understanding Layer**: Classifies queries and extracts entities
2. **Retrieval & Research Layer**: Searches vector databases and web sources
3. **Carbon Estimation & Synthesis**: Harmonizes data and estimates carbon impact
4. **Intent-Specific Processing**: Handles different query intents (estimate, compare, suggest)
5. **Response Generation**: Formats answers for user presentation

See [agentic_pipeline.md](mdc:agentic_pipeline.md) for a detailed workflow diagram.
